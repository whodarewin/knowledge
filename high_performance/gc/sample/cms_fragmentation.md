# 大对象分配+cms 碎片化导致的gc问题
## gc 配置
&emsp;&emsp;young区使用ParNew，old区使用CMS（中古时代标准配置），当老年代内存使用量到达70%时进行CMS gc，堆大小2G。
## gc 日志
    [GC (Allocation Failure) 2019-04-26T08:54:25.018+0800: 3062884.435: [ParNew (promotion failed): 506423K->496361K(546112K), 0.3494883 secs]2019-04-26T08:54:25.367+0800: 3062884.784: [CMS: 938184K->230509K(1365376K), 1.3652032 secs] 1443859K->230509K(1911488K), [Metaspace: 38125K->38125K(1085440K)], 1.7154995 secs] [Times: user=1.73 sys=0.00, real=1.72 secs]

## 分析
&emsp;&emsp;分析gc日志发现，young区到old区出现晋升失败，从而导致串行full gc，stw时间1.72s，即old区仍然有30%以上的空闲内存，但是找不到一个连续的可以分配大对象的空间。
## 解决
1. 降低CMS开始进行gc的时候的阈值，70% -> 60%
2. 将堆内存升高到4G。

问题解决。
